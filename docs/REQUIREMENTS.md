# GridSpire - 요구사항 정의서

## 개요

**GridSpire**는 Slay the Spire 스타일의 덱빌딩과 택티컬 그리드 전투를 결합한 2D 턴제 RPG이다.
단일 캐릭터가 아닌 **팀 단위**로 캐릭터를 운영하며, 그리드 위에서 **이동**과 **사거리** 개념이 적용된다.

- **엔진**: Godot 4.x (GDScript)
- **플랫폼**: PC (macOS / Windows / Linux)
- **장르**: 택티컬 덱빌딩 RPG

---

## 핵심 요구사항

### REQ-01: 그리드 기반 전투 맵

- 전투 맵은 **직사각형 그리드 격자**로 구성된다 (기본 10x8).
- 각 타일은 타입을 가진다:
  - **FLOOR**: 이동 가능한 일반 타일
  - **WALL**: 이동/시야 차단
  - **PIT**: 이동 불가 (함정)
  - **HAZARD**: 이동 가능하나 턴 시작 시 5 데미지
  - **ELEVATED**: 이동 가능, 방어 보너스
- 캐릭터는 타일 위에 위치하며, 한 타일에 하나의 캐릭터만 존재한다.

### REQ-02: 이동 시스템

- 각 캐릭터는 **이동 범위(move_range)** 스탯을 가진다.
- 이동은 **맨해튼 거리** 기반이며, BFS 경로 탐색으로 벽/점유 타일을 회피한다.
- 턴당 **1회** 이동 가능하다.
- ROOT 상태이상 시 이동 불가하다.
- 이동 범위는 파란색으로 하이라이트되고, 경로 미리보기가 표시된다.

### REQ-03: 사거리 시스템

- 카드/스킬은 **최소/최대 사거리(range_min, range_max)**를 가진다.
- 거리 계산은 맨해튼 거리를 사용한다.
- 사거리 패턴:
  - **DIAMOND**: 맨해튼 거리 기반 마름모
  - **LINE**: 직선 (벽에서 멈춤, 시야선 적용)
  - **CROSS**: 4방향 십자
  - **AREA**: 정사각형 범위
- 공격 사거리는 빨간색으로 하이라이트된다.

### REQ-04: 타임라인 턴 시스템

- FFX CTB 스타일의 **속도 기반 턴 시스템**을 사용한다.
- 각 캐릭터는 **speed** 스탯을 가진다 (낮을수록 빠르게 행동).
- 틱(tick) 누적 방식: 가장 낮은 tick을 가진 캐릭터가 다음 턴을 얻는다.
- 턴 종료 시 현재 speed만큼 tick에 더해진다.
- Haste는 speed × 0.75, Slow는 speed × 1.5로 적용된다.
- 타임라인 바에 다음 N턴의 순서가 미리 표시된다.

### REQ-05: 덱빌딩 카드 시스템

- 각 캐릭터는 **개별 덱**을 보유한다 (공유 덱이 아님).
- 턴 시작 시 드로우 파일에서 **5장** 드로우한다.
- 드로우 파일이 비면 디스카드 파일을 자동 셔플하여 보충한다.
- 카드 사용에는 **에너지**가 필요하다 (턴당 기본 3 에너지).
- 턴 종료 시 남은 핸드는 디스카드된다.
- 파일 구성: 드로우 파일, 핸드, 디스카드 파일, 소멸(exhaust) 파일

### REQ-06: 카드 효과

카드는 하나 이상의 효과를 가질 수 있다 (콤보 카드):

| 효과 | 설명 |
|------|------|
| DAMAGE | 대상에게 데미지 (Strength 보너스, Weakness 0.75x 감소) |
| HEAL | HP 회복 (최대 HP 초과 불가) |
| SHIELD | 시전자에게 실드 부여 (데미지 흡수) |
| BUFF | 아군에게 버프 (STRENGTH, HASTE, REGEN 등) |
| DEBUFF | 적에게 디버프 (WEAKNESS, SLOW, POISON, STUN, ROOT 등) |
| PUSH | 대상을 밀어냄 (벽/점유 타일에서 멈춤) |
| PULL | 대상을 끌어당김 |
| DRAW | 추가 카드 드로우 |
| MOVE | 강제 이동 |
| AREA_DAMAGE | 범위 데미지 |
| AREA_BUFF | 범위 버프 |
| AREA_DEBUFF | 범위 디버프 |

### REQ-07: 카드 타겟팅

- **SELF / NONE / ALL_***: 클릭 시 즉시 발동 (자동 타겟)
- **SINGLE_ENEMY / SINGLE_ALLY**: 클릭 → 사거리 표시 → 대상 클릭으로 선택
- **TILE / AREA**: 클릭 → 사거리 표시 → 타일 클릭으로 선택
- 우클릭으로 타겟팅 취소

### REQ-08: 캐릭터 시스템

- 아군은 **팀 단위**(2~4명)로 운영된다.
- 각 캐릭터 스탯: HP, Speed, Energy, Move Range, Deck
- 상태이상 시스템:
  - STRENGTH: 공격력 증가 (+stacks)
  - WEAKNESS: 데미지 0.75x
  - HASTE: 속도 0.75x (더 자주 행동)
  - SLOW: 속도 1.5x
  - SHIELD: 데미지 흡수
  - POISON: 턴 시작 시 스택만큼 데미지
  - REGEN: 턴 시작 시 스택만큼 회복
  - STUN: 턴 스킵
  - ROOT: 이동 불가
- 상태이상은 지속시간(duration)과 스택(stacks)을 가진다.

### REQ-09: 적 AI

- 적 턴은 자동으로 진행된다.
- 가장 가까운 아군에게 이동한다.
- 사거리 내 카드를 에너지가 허용하는 한 사용한다.
- 힐/버프 카드는 가장 HP가 낮은 아군에게 사용한다.
- 범위 카드는 가장 많은 아군을 포함하는 위치를 선택한다.

### REQ-10: 전투 흐름

```
전투 시작 → 그리드 생성 → 캐릭터 배치 → 덱 초기화
    ↓
타임라인 틱 → 가장 빠른 캐릭터 턴
    ↓
[아군 턴]                    [적 턴]
드로우 → 행동(카드/이동) →   AI 자동 행동 →
턴 종료 → 디스카드           턴 종료
    ↓
승리/패배 체크 → 계속 or 종료
```

- 승리 조건: 모든 적 사망
- 패배 조건: 모든 아군 사망

### REQ-11: UI 요구사항

- **전투 HUD**: 현재 캐릭터 정보 (이름, HP바, 에너지, 상태이상)
- **카드 핸드**: 화면 하단에 카드 나열, 호버 시 확대, 사용 불가 카드는 회색 처리
- **타임라인 바**: 우측에 다음 10턴 순서 표시 (현재 턴 노란색, 아군 파란색, 적 빨간색)
- **데미지 팝업**: 피해/회복 시 부유하는 숫자 표시
- **End Turn 버튼**: 우하단
- **타이틀 화면**: New Game / Continue / Settings
- **전투 결과**: 승리/패배 오버레이

---

## 향후 요구사항 (미구현)

### REQ-F01: 오버월드 맵
- Slay the Spire 스타일 노드 맵 (전투/이벤트/상점/휴식 등)

### REQ-F02: 보상 시스템
- 전투 승리 시 카드/골드/유물 보상 선택

### REQ-F03: 상점
- 골드로 카드 구매/제거

### REQ-F04: 유물 시스템
- 패시브 효과를 주는 유물 아이템

### REQ-F05: 다중 스테이지
- 여러 층(Act)으로 구성된 런 구조, 보스전 포함

### REQ-F06: 캐릭터 해금/성장
- 런 간 영구 진행 요소
